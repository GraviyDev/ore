# Детальный разбор механики и экономики ORE

Данный документ содержит подробное описание игровой механики, токеномики и устройства смарт-контрактов протокола ORE.

## 1. Общая концепция

ORE позиционирует себя как "Native Store of Value" на Solana, но технически представляет собой **PvP-майнинг протокол**. Это игра с отрицательной суммой по SOL (из-за комиссий и налогов), но с положительной суммой по токену ORE (за счет эмиссии).

Суть игры: Майнеры делают ставки в SOL на клетки доски 5x5. В конце раунда выбирается случайная клетка. Победители делят SOL проигравших и получают свеженапечатанные токены ORE.

## 2. Игровая механика (Board & Rounds)

Игра циклична и разбита на раунды. Состояние отслеживается в аккаунте `Board`.

### Структура раунда
1.  **Deploy (Размещение):** Майнеры отправляют транзакции `Deploy`, выбирая одну или несколько из 25 клеток (маска битов) и прикладывая сумму SOL.
    *   Ставка добавляется к `cumulative` (накопленному) значению клетки.
2.  **Reset (Сброс):**
    *   Раунд длится определенное количество слотов.
    *   Когда время выходит, любой может вызвать `Reset`.
    *   Используется `entropy_api` для генерации случайности (`slot_hash`).
    *   Определяется **Winning Square** (Выигрышная клетка) по формуле: `rng % 25`.
    *   Раунд завершается, начинается следующий.
3.  **Checkpoint (Фиксация):**
    *   Майнеры должны сами вызвать инструкцию `Checkpoint`, чтобы проверить, выиграли ли они в *прошлом* раунде.
    *   Именно здесь происходит выплата наград.

---

## 3. Экономика и Денежные потоки (Economy)

Экономика ORE состоит из двух слоев: перераспределение SOL и эмиссия ORE.

### 3.1. SOL: Потоки и Комиссии

Когда раунд завершается (`Reset`), SOL на доске распределяется следующим образом:

1.  **Возврат депозита:** Победители получают обратно свои ставки за вычетом **1% комиссии протокола**.
2.  **Формирование пула выигрыша:** Ставки со всех *проигрышных* клеток собираются в общий пул.
3.  **Комиссии с пула:**
    *   **1% Admin Fee:** Уходит сборщику комиссий.
    *   **10% Vault (Treasury):** Отправляется в Казначейство. Эти средства обеспечивают ценность ORE (см. раздел "Buyback").
4.  **Выплата победителям:** Оставшиеся ~89% пула проигравших делятся между победителями на выигрышной клетке пропорционально их доле ставок.

### 3.2. ORE: Эмиссия и Награды

Эмиссия ORE алгоритмически ограничена.

*   **Max Supply:** 5,000,000 ORE.
*   **Base Reward:** Максимум 1 ORE за раунд. Если саплай приближается к максимуму, награда уменьшается.
*   **Типы наград (определяются в `Reset`):**
    1.  **Split Reward (50% шанс):** Награда (1 ORE) делится поровну между *всеми* майнерами на выигрышной клетке. Адрес победителя устанавливается как специальный `SPLIT_ADDRESS`.
    2.  **Top Miner (50% шанс):** Весь 1 ORE забирает **один** случайный победитель. Вероятность стать Top Miner пропорциональна доле ставки на клетке.
    3.  **Motherlode (Джекпот):** Шанс 1 к 625 (0.16%). В каждом раунде 0.2 ORE печатается в пул Motherlode. Если выпадает джекпот, победитель(и) забирает весь накопленный пул.

*Техническая особенность "Lazy Evaluation":*
В случае "Top Miner" победитель не записывается в блокчейн во время `Reset`. Вместо этого, при вызове `Checkpoint`, каждый майнер проверяет, попадает ли его диапазон ставок в случайно сгенерированное число победителя (`top_miner_sample`). Тот, кто попал — забирает приз.

### 3.3. Стейкинг и Механизм Buyback

Протокол создает фундаментальную ценность токена через механизм обратного выкупа.

1.  **Наполнение Казначейства:** 10% от всех проигрышных ставок SOL попадает в `Treasury`.
2.  **Buy & Burn (Bury):** Любой может вызвать инструкцию `Bury` (при наличии прав/условий) или админ (Bury Authority). Скрипт меняет SOL из казначейства на ORE через Jupiter (или другой DEX), используя ликвидность рынка.
3.  **Распределение выкупленного:**
    *   **90%** купленных ORE сжигаются (уменьшение предложения).
    *   **10%** распределяются между **Стейкерами**.

Это создает доходность для стейкеров ORE, не зависящую от инфляции, а зависящую от активности игроков (объема проигранных SOL).

### 3.4. Налог на клейм (Holding Tax)

Интересная механика удержания пользователей от мгновенной продажи.

*   При вызове `ClaimORE` взимается **10% комиссия** с суммы награды.
*   Эта комиссия **не сжигается**. Она перераспределяется между всеми остальными майнерами, у которых есть *незаклеймленные* награды (`rewards_ore` > 0).
*   **Стратегия:** Пользователю выгодно накапливать награды на балансе контракта, чтобы пассивно получать долю от клеймов других нетерпеливых игроков.

---

## 4. Автоматизация (Automation)

Протокол имеет встроенную поддержку делегирования майнинга ботам (Executors) без передачи приватных ключей от кошелька.

### Архитектура
*   Пользователь создает аккаунт `Automation`.
*   Депонирует туда SOL (для ставок и оплаты комиссий боту).
*   Назначает `Executor` (исполнителя) — адрес бота, который будет отправлять транзакции.

### Стратегии
В контракте заложены три стратегии поведения (`automate.rs`):

1.  **Preferred (Предпочитаемая):** Пользователь сам задает маску клеток (куда ставить). Бот просто выполняет действие каждый раунд.
2.  **Random (Случайная):** Бот генерирует случайную маску на основе хеша (Адрес юзера + ID раунда). Это защищает от фронтрана или манипуляций со стороны самого бота, так как бот не выбирает клетки.
3.  **Discretionary (На усмотрение):** Бот сам решает, на какие клетки ставить (в рамках лимита суммы). Это позволяет ботам использовать сложные off-chain алгоритмы для предсказания или оптимизации.

### Оплата
Боту выплачивается фиксированная комиссия (`fee`) за каждый первый деплой в раунде. Это покрывает расходы бота на газ и дает прибыль.

## 5. Резюме

ORE — это геймифицированный протокол распределения токенов.
*   **Для игрока:** Это рулетка. Ставишь SOL, если угадал клетку — отбиваешь ставку + получаешь профит в SOL + получаешь ORE.
*   **Для инвестора:** Ценность ORE обеспечивается постоянным выкупом за счет проигранных ставок (Revenue Share через сжигание и стейкинг).
*   **Для бота:** Возможность зарабатывать безрисковый доход, обслуживая автоматизацию игроков.
